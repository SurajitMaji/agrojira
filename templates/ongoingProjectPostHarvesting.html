{% extends 'ongoingProjectBase.html'%}
{% load static %}

{% block title %}{{project.crop_name}} Project - Post Harvesting{% endblock title %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/completedProject.css' %}">
<link rel="stylesheet" href="{% static 'css/ongoingProjectSoil.css' %}">
{% endblock head %}

{% block projectDetailsBody %}
<div class="project-datails-container">

  {% if not postharvests %}
  <div class="each-soil-form">
    <div class="header">Post Harvesting Details Form</div>
    <form method="POST" action="/submit_farmerPostHarvesting" enctype="multipart/form-data">
      {% csrf_token %}
      <div class="section"><div class="label">Cleaning:</div><div class="value"><textarea name="cleaning" required></textarea></div></div>
      <div class="section foreign_key"><div class="label">Project Id:</div><div class="value"><input type="number" name="project_id" readonly value="{{project.project_id}}"></div></div>
      <div class="section"><div class="label">Sorting:</div><div class="value"><textarea name="sorting" required></textarea></div></div>
      <div class="section"><div class="label">Drying Method:</div><div class="value"><textarea name="drying_method" required></textarea></div></div>
      <div class="section"><div class="label">Packaging:</div><div class="value"><textarea name="packaging" required></textarea></div></div>
      <div class="section"><div class="label">Storage Method:</div><div class="value"><textarea name="storage_method" required></textarea></div></div>
      <div class="section"><div class="label">Storage Duration:</div><div class="value"><input type="text" name="storage_duration" required></div></div>
      <div class="section"><div class="label">Storage Equipment:</div><div class="value"><textarea name="storage_equipment" required></textarea></div></div>
      <div class="section"><div class="label">Post Harvesting Image:</div><div class="value">
        <input type="file" name="post_harvesting_image" required onchange="preview(this,'photo_preview')">
        <img alt="Post Harvesting Image" id="photo_preview">
      </div></div>
      <div class="buttons">
        <button type="submit" class="edit-btn">Submit</button>
      </div>
    </form>
  </div>

  {% else %}
  {% for post in postharvests %}
  <div class="each-soil-recorder">
    <div class="header">Post Harvest Report No: {{forloop.counter}}</div>
    <div class="section"><div class="label">Cleaning:</div><div class="value">{{post.cleaning}}</div></div>
    <div class="section"><div class="label">Sorting:</div><div class="value">{{post.sorting}}</div></div>
    <div class="section"><div class="label">Drying Method:</div><div class="value">{{post.drying_method}}</div></div>
    <div class="section"><div class="label">Packaging:</div><div class="value">{{post.packaging}}</div></div>
    <div class="section"><div class="label">Storage Method:</div><div class="value">{{post.storage_method}}</div></div>
    <div class="section"><div class="label">Storage Duration:</div><div class="value">{{post.storage_duration}}</div></div>
    <div class="section"><div class="label">Storage Equipment:</div><div class="value">{{post.storage_equipment}}</div></div>
    <div class="section"><div class="label">Is Completed:</div><div class="value">{{post.is_completed}}</div></div>
    <div class="section"><div class="label">Created At:</div><div class="value">{{post.created_at}}</div></div>
    <div class="section"><div class="label">Updated At:</div><div class="value">{{post.updated_at}}</div></div>
    <div class="section"><div class="label">ML Prediction:</div><div class="value">{{post.ml_prediction}}</div></div>
    <div class="section"><div class="label">ML Confidence:</div><div class="value">{{post.ml_confidence}}</div></div>
    <div class="section"><div class="label">Post Harvesting Image:</div>
      <div class="value"><img src="{{post.post_harvesting_image.url}}" alt="Post Harvesting Image"></div>
    </div>
    <div class="buttons">
      {% comment %} <a href="{% url 'ongoingProjectPostHarvestingUpdate' project.project_id post.farmer_post_harvesting_id %}">
        <button class="edit-btn">Edit</button>
      </a>
      <button class="delete-btn" onclick="deleteReport()">Delete</button> {% endcomment %}
    </div>
  </div>
  {% endfor %}
  {% endif %}
</div>

<script>
function deleteReport() {
  if (confirm("Are you sure you want to delete this report?")) {
    alert("Delete functionality goes here.");
  }
}
</script>
{% endblock projectDetailsBody %}

{% block javaScript %}
<script src="{% static 'js/imagePreview.js' %}"></script>
{% endblock javaScript %}
